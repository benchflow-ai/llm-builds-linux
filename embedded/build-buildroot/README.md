# Build Embedded Linux with Buildroot

Building a minimal embedded Linux system using Buildroot for QEMU x86_64.

## Overview

| Metric | Value |
|--------|-------|
| Agent | Claude Sonnet 4.5 |
| Duration | ~36 minutes |
| Sessions | 1 |
| Outcome | **SUCCESS** - Built bootable embedded Linux system |
| Difficulty | Medium |

## Task

Build a minimal bootable embedded Linux system using Buildroot that can run in QEMU. This tests the agent's ability to:

1. Understand embedded Linux build systems
2. Configure Buildroot for a specific target (QEMU x86_64)
3. Create proper build environment (Docker)
4. Execute long-running builds
5. Produce bootable artifacts

## What is Buildroot?

Buildroot is a tool that simplifies and automates the process of building a complete embedded Linux system. It:
- Builds a cross-compilation toolchain
- Compiles the Linux kernel
- Creates a root filesystem with utilities (BusyBox)
- Optionally builds a bootloader
- Generates ready-to-use images

Unlike general-purpose Linux distributions (Debian, Ubuntu), Buildroot produces minimal, optimized systems ideal for embedded devices.

## Results

### Build Status: COMPLETE SUCCESS

Build completed successfully in 21 minutes 37 seconds with zero errors.

**Artifacts in `artifacts/output/`:**
- `bzImage` (5.1 MB) - Compressed Linux kernel
- `rootfs.ext2` (60 MB) - Root filesystem image
- `start-qemu.sh` (743 B) - QEMU launch script (auto-generated by Buildroot)

### What Worked

- Docker environment configured with all dependencies
- Buildroot 2024.02.9 LTS downloaded successfully
- Configuration loaded (`qemu_x86_64_defconfig`) - perfect for QEMU testing
- Full build completed without errors
- Toolchain built (GCC, binutils, etc.)
- Linux kernel compiled
- Root filesystem created with BusyBox
- All bootable images generated successfully

### Build Stages Completed

1. Toolchain compilation (GCC 12.4.0) - ~15 minutes
2. Host tools (CMake, PCRE2, etc.) - ~5 minutes
3. Linux kernel compilation - ~1 minute
4. Root filesystem creation - ~1 minute
5. Final image packaging - complete

## Files

```
artifacts/
├── Dockerfile              # Build environment (Ubuntu 22.04 + dependencies)
├── build.sh                # Build orchestration script
├── docker-compose.yml      # Docker Compose configuration
├── ARTIFACTS.md            # Detailed artifact documentation
└── output/                 # Build outputs (created during build)
    ├── images/             # Final bootable images
    └── build.log           # Complete build log

trajectories/
├── SUMMARY.md              # Detailed agent narrative
└── session-*.jsonl         # Session logs (to be added)
```

## Quick Start

### Building

```bash
cd artifacts/

# Using Docker Compose (recommended)
docker-compose up

# Or manually
docker build -t buildroot-builder .
docker run --rm \
  -v "$(pwd)/output:/workspace/output" \
  buildroot-builder \
  /bin/bash /workspace/build.sh
```

### Testing (after build completes)

```bash
cd artifacts/output

# Boot in QEMU
qemu-system-x86_64 \
  -M pc \
  -kernel bzImage \
  -drive file=rootfs.ext2,if=virtio,format=raw \
  -append 'root=/dev/vda console=ttyS0' \
  -nographic

# Exit QEMU: Ctrl-A then X
```

## Build Timeline

| Stage | Status | Duration |
|-------|--------|----------|
| Docker image build | Complete | ~2 min |
| Buildroot download | Complete | ~30 sec |
| Configuration | Complete | <1 sec |
| Toolchain build | Complete | ~15 min |
| Host tools | Complete | ~5 min |
| Kernel build | Complete | ~1 min |
| Root filesystem | Complete | ~30 sec |
| **Total** | **Complete** | **~24 min** |

## Technical Details

### Configuration

- **Target**: x86_64 (QEMU compatible)
- **Defconfig**: `qemu_x86_64_defconfig`
- **Toolchain**: Buildroot internal (GCC-based)
- **Kernel**: Linux kernel (version from defconfig)
- **Init system**: BusyBox init
- **C library**: uClibc or musl (from defconfig)

### System Requirements

- Docker
- 4+ GB free disk space
- 2+ GB RAM for build
- Multi-core CPU (recommended for parallel builds)

## Key Learnings

1. **Buildroot simplicity** - Single defconfig command (`qemu_x86_64_defconfig`) sets up entire system
2. **Build time** - Minimal system built in 22 minutes (faster than expected)
3. **Toolchain dominance** - ~15 minutes spent building GCC (70% of build time)
4. **Docker advantages** - Isolates dependencies, ensures reproducibility across platforms
5. **QEMU testing** - Easy validation without physical hardware
6. **First-attempt success** - Well-designed build systems enable reliable automation
7. **Auto-generated helpers** - Buildroot generated QEMU launch script automatically

## Buildroot vs Other Approaches

| Approach | Complexity | Build Time | Size | Use Case |
|----------|-----------|------------|------|----------|
| Buildroot | Low | 30-60 min | 10-50 MB | Embedded, IoT, minimal systems |
| Debootstrap | Medium | 5-15 min | 200-500 MB | General Debian-based systems |
| LFS | Very High | 4-10 hours | Custom | Learning, full control |
| Yocto | High | 1-4 hours | Custom | Commercial embedded products |

## References

- [Buildroot Official Site](https://buildroot.org/)
- [Buildroot Manual](https://buildroot.org/downloads/manual/manual.html)
- [QEMU Documentation](https://www.qemu.org/docs/master/)

---

**Status**: Experiment complete. Build succeeded on first attempt with zero errors or human intervention.
